<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link rel="stylesheet" href="styles.css">

    <title>DDD Tutorials</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="index.html">DDD Tutorials</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li>
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          GitHub Basics: Lab 1
      </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="GHB1WhatIsGitHub.html">What is GitHub?</a>
          <a class="dropdown-item" href="GHB1CreatingAGitHubAccount.html">Creating a GitHub Account</a>
          <a class="dropdown-item" href="GHB1GitHubDesktopSetup.html">GitHub Desktop Setup</a>
          <a class="dropdown-item" href="GHB1CreatingARepository.html">Creating A Repository</a>
          <a class="dropdown-item" href="GHB1AccessingARepository.html">Accessing A Repository</a>
          <a class="dropdown-item" href="GHB1TrackingRepositoryChanges.html">Tracking Repository Changes</a>
        </div>
    </li>
    <li>
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          GitHub Basics: Lab 2
      </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="GHB2GitHubContinued.html">GitHub Continued</a>
          <a class="dropdown-item" href="GHB2BranchingInGitHubDesktop.html">Branching in GitHub Desktop</a>
          <a class="dropdown-item" href="GHB2MergingInGitHubDekstop.html">Merging in GitHub Desktop</a>
          <a class="dropdown-item" href="GHB2Conflicts.html">Conflicts</a>
          <a class="dropdown-item" href="GHB2ProjectManagement.html">Project Mangement using GitHub</a>
        </div>
    </li>
    <li>
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Automation Using GitHub Actions
      </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="AUTOCICDintro.html">Introduction To CICD</a>
          <a class="dropdown-item" href="AUTOYAMLfiles.html">What Are YAML files?</a>
          <a class="dropdown-item" href="AUTOGitHubActions.html">Setting Up A GitHub Action</a>
          <a class="dropdown-item" href="AUTODeploying.html">Deploying To A Local Machine/VM</a>
        </div>
    </li>
    <li>
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Optional: GitHub In The Command Line
      </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="CMDgit.html">Checking For And Installling GIT</a>
          <a class="dropdown-item" href="CMDCreatingARepo.html">Creating A Local Repository</a>
          <a class="dropdown-item" href="CMDLinkingToGithub.html">Linking Repository To GitHub</a>
          <a class="dropdown-item" href="CMDChangingARepo.html">Making Changes To Repository</a>
          <a class="dropdown-item" href="CMDUploadingToGitHub.html">Uploading To GitHub</a>
          <a class="dropdown-item" href="CMDBranchingAndMerging.html">Branching and Merging</a>
        </div>
    </li>
      <li>
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Optional: Unity Tutorials
      </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="UNITYTesting.html">Using The Test Runner</a>
          <a class="dropdown-item" href="Unitygit.html">Using Unity With GitHub</a>
        </div>
    </li>
    </ul>
  </div>
</nav>

    <h1>Deploying Files</h1>

    <h2>Local Deployment With GitHub Actions</h2>

    <p>If you are planning on deploying to a local machine (or a VM) there are certain steps, you need to take alongside a completed YAML file to ensure that your project deploys correctly. The first of these is to set up a runner on your GitHub machine using the runner system that is built into GitHub actions. </p>

    <p>To do this, from your main repository window you need to first click on settings on the right-hand side of the side of the toolbar</p>

    <img src="Images/LocalDeployment/001.jpg">

    <p>From the settings window you then need to select the actions dropdown from the menu on the left hand side, and then select the “runners” option.</p>

    <img src="Images/LocalDeployment/002.jpg">

    <p>You must then click the “New self-hosted runner” button on the top right hand side of the screen. </p>

    <img src="Images/LocalDeployment/003.jpg">

    <p>You should then select the “Windows” option from the three toolbars at the top, as our VM is currently running a Windows build. If you are looking to test this on a local machine you should select the OS you are planning to build on.</p>

    <p>Open an instance of PowerShell and copy the commands from the first two boxes into it. Around three quarters of the way through this process you will end up with a screen like the one below. </p>

    <img src="Images/LocalDeployment/004.jpg">

    <p>When setting up your runner, leave the name of it’s runner group as default, and then give it a name that makes sense.</p>

    <p>When the next option appears asking if you wish to add any additional labels press the enter button to skip.</p>

    <p>You then must create a name for your work folder – GitHub’s system suggests to keep this as _work, so that is what we are going to do. </p>

    <p>The next option asks if we would like to make the runner operate as a service – this means that the runner will start automatically when we start our OS. For now we are going to leave this as the default no, but if you are setting up a fully automated system in the future you may want to set this to yes.</p>

    <p>When this setup is complete you can run the final command “./run.cmd” to start your runner listening.</p>

    <img src="Images/LocalDeployment/005.jpg">

    <p>This means that it is currently waiting for an action to begin speaking to it and telling it what to do.</p>

    <p>Now we have our action listening, we need to write a YAML file that will allow us to connect to our runner and provide it with our application.</p>

    <p>If you don’t know what a YAML is, or how they work – please check the tutorial on YAMLs provided!</p>

    <img src="Images/LocalDeployment/006.jpg">

    <p>The above YAML file will take your GitHub repository and then push it to your VM, automatically copying your files to the default location for IIS.  – you must have made sure to have created and have your GitHub actions runner running before you complete this process, or the repo will have nothing to push to.</p>

    <p>A few things to take note of:</p>
    <ol>
      <li>You will need to replace the “Path\To\Your\GitHub\Action\File” with the file location for the file created by your GitHub runner for your repo. If you placed your runner on your C: Drive this will likely be C: -> actions-runner -> _work -> name-of-your-repo.</li>
      <li>The asterisk (*) at the end of the folder structure is important for the copy to work properly – do not delete it! </li>
      <li>The “-Force” command overwrites files within the directory even if they already exist – this prevents the GitHub action from failing because it can’t create a new file.</li>
    </ol> 

    <p>Once you have done this you may commit your YAML file – once the process has completed, if it is successful, you will be able to access your site from anywhere on campus using your VMs IP address.</p>

    <h2>Deploying to GitHub Pages using GitHub Actions and Unity</h2>

    <p>One of the features of GitHub we can use when putting together a workflow that involves hosting a project is GitHub pages, which is a service provided by GitHub that allows you to host projects for free directly from your repository – as long as they are static websites.</p>

    <p>GitHub pages also has support for WebGL, which means that we can use it to host compiled Unity projects and make them accessible using the browser.</p>

    <p>Before we start hosting however, we need to add some information to our GitHub repository that will let it know our Unity credentials – GitHub needs these so it can push them into our virtual machine and use them to build and test our projects. </p>

    <p>To do this, we must first request a licence file from Unity. We can do this using a YAML file.</p>

    <p>In GitHub navigate to the actions section and generate a new action, naming the action “activation”.</p>

    <p>Enter the following YAML code and commit your completed action.</p>

    <img src="Images/LocalDeployment/007.jpg">

    <p>Commit your action and navigate to your recently created activation file action and you will see at the bottom of the page that if it succeeded it has created something called a an artifact, this is a file output that has come from running your YAML file. And should have the name of the Unity version used to upload the file followed by the extension “.alf “</p>

    <img src="Images/LocalDeployment/008.jpg">

    <p>Download the “. alf” file to your machine and extract the zip so that it can be accessed.</p>

    <p>When you have downloaded your file then navigate to: https://license.unity3d.com/manual - you may be prompted to log into your Unity account – you may also run into a problem where the Unity licence website keeps refreshing – if this happens you may need to swap to a different browser. </p>

    <p>Upload your “.alf” file using the on screen tool and you will be redirected to see if you would like to generate a licence for Unity personal or Pro, select personal and you when you have filled in the required information you will be asked to download the completed licence file.</p>

    <img src="Images/LocalDeployment/009.jpg">

    <p>When this has been completed you should then have downloaded a “.ulf” file – do not worry if this file does not match the name of your current Unity installation. They are backwards compatible.</p>

    <p>Open your “.ulf” file using notepad and you should be greeted with an XML file that contains a collection of random characters for the signature – this is your Unity licence – we will need this in a second.</p>

    <p>Navigate back to GitHub and into the repository that you are going to use, and click the settings option from the main GUI window.</p>

    <img src="Images/LocalDeployment/010.jpg">

    <p>From the settings window navigate down to security and click the secrets and variables section and then select “actions”</p>

    <img src="Images/LocalDeployment/011.jpg">

    <p>From this menu you should then select the “New repository secret” button that is visible on the top right-hand side of the menu. </p>

    <img src="Images/LocalDeployment/012.jpg">

    <p>This will redirect you to the new secret wizard.</p>

    <p>In order for your GitHub action to pick up your license correctly you must give your secret the name UNITY_LICENSE, and then paste the license you downloaded earlier into the secret box.</p>

    <img src="Images/LocalDeployment/013.jpg">

    <p>Once this is complete press the add secret button and your secret will be added to your GitHub account. </p>

    <p>We are now free to setup a YAML file for the testing and deployment of our Unity files. </p>

    <img src="Images/LocalDeployment/014.jpg">

    <h2>Preparing a Blazor Pages Document For Deployment</h2>
    <p>If you wish to deploy a Blazor application to your Virtual Machine, there are a couple of steps that you need to take first.</p>

    <h3>Installing the .Net Core hosting bundle</h3>

    <p>In order for IIS to be able to host your created Blazor application it must first have access to the ASPNetCoreModule. To get access to this on your virtual machine you must first install the ASP.NET core hosting bundle that is provided by Microsoft and can be found at the link below:</p>

    <a href="https://download.visualstudio.microsoft.com/download/pr/ff197e9e-44ac-40af-8ba7-267d92e9e4fa/d24439192bc549b42f9fcb71ecb005c0/dotnet-hosting-7.0.3-win.exe">Click Me For The Hosting Bundle</a>

    <p>Once you have installed the hosting bundle restart the IIS process by closing out of it and typing “iisreset” in the command prompt.</p>

    <img src="Images/LocalDeployment/015.jpg">

    <p>you can check that it has been installed successfully by navigating to IIS, selecting your server and selecting the modules tool.</p>

    <img src="Images/LocalDeployment/016.jpg">

    <p>Clicking modules should then redirect you to the modules window, and will provide you with a list of modules that IIS currently recognises.</p>

    <p>You should now have a module named “AspNetCoreModuleV2”, this means that the module and bundle have been installed correctly and you can now host Blazor applications on your IIS server. </p>

    <img src="Images/LocalDeployment/017.jpg">

    <h3>Readying Blazor Document For Deployment</h3>

    <p>Now you have prepared your server to host Blazor documents, we are now going to publish our created Blazor application in a way that will allow the server to host it.</p>

    <p>Ensure that the debug version of your Blazor document is working correctly, then right click on your Blazor document and choose “publish”</p>

    <img src="Images/LocalDeployment/018.jpg">

    <p>This will redirect you to the publish wizard within Visual Studio. There are several options we can use here but for the purpose of this demonstration click folder, and then next.</p>

    <img src="Images/LocalDeployment/019.jpg">

    <p> Leave the folder location that appears within the next screen at its default, and then click finish, then close.</p>

    <p>This will change publish window to show you that you currently have a file that is ready to be published. To do this navigate to the button on the top right hand side of the wizard that says publish, and click it.</p>

    <img src="Images/LocalDeployment/020.jpg">

    <p>This will build your program and then Publish it to the folder. When this process has been completed Visual Studio should give you a prompt to say that is has been done successfully.</p>

    <img src="Images/LocalDeployment/021.jpg">

    <p>Click open folder and you should see the output of your published document – remember where these are you will need them later! </p>

    <img src="Images/LocalDeployment/022.jpg">

    <h2>Local Deployment Without GitHub Actions</h2>
    <h3>Copying Files to The Virtual Machine</h3>
    <p>Before we copy our files over to the Virtual Machine we must first locate the folder where our host files are placed.</p>

    <p>Log into your virtual machine and navigate to the root drive. You then need to go to inetpub -> wwwroot.</p>

    <p>The “wwwroot” folder is the file we are going to place all of our application data into and what in turn IIS will pick from to host, there may currently be items in there, this is normal, and is the standard IIS template page.</p>

    <img src="Images/LocalDeployment/023.jpg">

    <p>Go back to your local machine and find the files that you wish to host on your server – for the purpose of this demonstration we are going to use the Blazor documents we created in the previous step – but any web format will do.</p>

    <p>Highlight all of the files that you need, either press right click and copy, or press ctrl+C on your keyboard.</p>

    <p>Navigate back to your virtual machine, specifically the wwwroot file we navigated to earlier and paste your files in, using either right click and paste or ctrl+V.</p>

    <img src="Images/LocalDeployment/024.jpg">

    <p>You can now delete the provided iis files if you wish. </p>

    <p>To check and see your files are being hosted correctly go back to your local machine and open a browser – enter the name of your VM as the address and you should be greeted by your created website!</p>




    





    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>